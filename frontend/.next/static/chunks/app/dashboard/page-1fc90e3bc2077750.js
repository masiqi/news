(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{4774:function(e,t,n){Promise.resolve().then(n.bind(n,7281))},9376:function(e,t,n){"use strict";var i=n(5475);n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}})},7281:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var i=n(7437),s=n(2265),o=n(9376),r=n(1837);function a(e){return new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}function l(e){return e?({positive:"积极",negative:"消极",neutral:"中性",mixed:"复杂",very_positive:"非常积极",very_negative:"非常消极"})[e.toLowerCase()]||e:"未知"}function c(){let e=(0,o.useRouter)(),[t,n]=(0,s.useState)("content"),[c,d]=(0,s.useState)([]),[p,x]=(0,s.useState)([]),[h,u]=(0,s.useState)({page:1,pageSize:20,total:0,totalPages:0}),[g,m]=(0,s.useState)(1),[f,y]=(0,s.useState)(null),[j,b]=(0,s.useState)(!0),[S,v]=(0,s.useState)(""),[k,w]=(0,s.useState)(!1),[z,C]=(0,s.useState)({url:"",name:"",description:"",isPublic:!1});(0,s.useEffect)(()=>{if(!localStorage.getItem("auth_token")){e.push("/login");return}B()},[t,g,e]);let B=async()=>{b(!0),v("");try{if("sources"===t){let t=await r.h.getSources();if(t.success){var e;d((null===(e=t.data)||void 0===e?void 0:e.sources)||t.data||[])}}else{let e=await r.h.getContent({page:g,pageSize:20});e.success&&(x(e.contents||[]),e.pagination&&u(e.pagination))}}catch(e){v("加载数据失败"),console.error("Load data error:",e)}finally{b(!1)}},R=async()=>{if(!z.url.trim()){v("RSS地址不能为空");return}if(!z.name.trim()){v("RSS名称不能为空");return}v(""),b(!0);try{let e=await fetch("".concat("https://moxiang-distill-api.masiqi.workers.dev","/api/v1/sources"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))},body:JSON.stringify({url:z.url,name:z.name,description:z.description,isPublic:z.isPublic})});if(e.ok)C({url:"",name:"",description:"",isPublic:!1}),w(!1),B();else{let t=await e.json();v(t.error||"添加 RSS 源失败")}}catch(e){v((null==e?void 0:e.message)||"添加 RSS 源失败"),console.error("Add source error:",e)}finally{b(!1)}},N=async e=>{v(""),b(!0);try{let t=await fetch("".concat("https://moxiang-distill-api.masiqi.workers.dev","/api/v1/sources/").concat(e,"/trigger-fetch"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("auth_token"))}}),n=await t.json();t.ok?(v(""),alert("抓取任务已提交到队列，请稍后查看结果"),B()):v(n.error||"触发抓取失败")}catch(e){v((null==e?void 0:e.message)||"触发抓取失败"),console.error("Trigger fetch error:",e)}finally{b(!1)}};return(0,i.jsxs)("div",{style:{minHeight:"100vh"},children:[(0,i.jsx)("header",{className:"header",children:(0,i.jsx)("div",{className:"container",children:(0,i.jsxs)("nav",{className:"nav",children:[(0,i.jsx)("div",{className:"logo",children:"墨香蒸馏"}),(0,i.jsxs)("div",{className:"nav-links",children:[(0,i.jsx)("a",{href:"/dashboard",children:"仪表板"}),(0,i.jsx)("button",{onClick:()=>{localStorage.removeItem("auth_token"),e.push("/")},className:"btn btn-secondary",style:{padding:"8px 16px"},children:"退出登录"})]})]})})}),(0,i.jsxs)("div",{className:"container",style:{paddingTop:"32px"},children:[(0,i.jsx)("div",{style:{marginBottom:"24px",borderBottom:"2px solid #eee"},children:(0,i.jsxs)("div",{style:{display:"flex",gap:"32px"},children:[(0,i.jsx)("button",{onClick:()=>n("content"),style:{padding:"12px 0",border:"none",background:"none",fontSize:"16px",fontWeight:"500",cursor:"pointer",borderBottom:"content"===t?"2px solid #0070f3":"2px solid transparent",color:"content"===t?"#0070f3":"#666",marginBottom:"-2px"},children:"内容"}),(0,i.jsx)("button",{onClick:()=>n("sources"),style:{padding:"12px 0",border:"none",background:"none",fontSize:"16px",fontWeight:"500",cursor:"pointer",borderBottom:"sources"===t?"2px solid #0070f3":"2px solid transparent",color:"sources"===t?"#0070f3":"#666",marginBottom:"-2px"},children:"RSS 源"})]})}),S&&(0,i.jsx)("div",{style:{padding:"12px 16px",background:"#fee",color:"#c33",borderRadius:"6px",marginBottom:"20px",fontSize:"14px"},children:S}),"sources"===t&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,i.jsx)("h2",{style:{fontSize:"24px",fontWeight:"700"},children:"我的 RSS 源"}),(0,i.jsx)("button",{onClick:()=>w(!k),className:"btn btn-primary",children:k?"取消":"添加 RSS 源"})]}),k&&(0,i.jsxs)("div",{className:"card",style:{marginBottom:"20px"},children:[(0,i.jsx)("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"16px"},children:"添加新的 RSS 源"}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["RSS名称 ",(0,i.jsx)("span",{style:{color:"#c33"},children:"*"})]}),(0,i.jsx)("input",{type:"text",className:"input",value:z.name,onChange:e=>C({...z,name:e.target.value}),placeholder:"例如：阮一峰的网络日志",required:!0})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsxs)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:["RSS地址 ",(0,i.jsx)("span",{style:{color:"#c33"},children:"*"})]}),(0,i.jsx)("input",{type:"url",className:"input",value:z.url,onChange:e=>C({...z,url:e.target.value}),placeholder:"https://example.com/rss.xml",required:!0}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#999",marginTop:"4px"},children:"输入完整的RSS订阅地址"})]}),(0,i.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,i.jsx)("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500"},children:"描述信息"}),(0,i.jsx)("textarea",{className:"input",value:z.description,onChange:e=>C({...z,description:e.target.value}),placeholder:"简要描述这个RSS源的内容（选填）",rows:3,style:{resize:"vertical"}})]}),(0,i.jsx)("div",{style:{marginBottom:"20px"},children:(0,i.jsxs)("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[(0,i.jsx)("input",{type:"checkbox",checked:z.isPublic,onChange:e=>C({...z,isPublic:e.target.checked}),style:{marginRight:"8px",width:"16px",height:"16px"}}),(0,i.jsx)("span",{style:{fontSize:"14px"},children:"设为公开源（其他用户也可以订阅）"})]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,i.jsx)("button",{onClick:R,className:"btn btn-primary",disabled:j,children:j?"添加中...":"确认添加"}),(0,i.jsx)("button",{onClick:()=>{w(!1),C({url:"",name:"",description:"",isPublic:!1}),v("")},className:"btn btn-secondary",disabled:j,children:"取消"})]})]}),j?(0,i.jsx)("div",{className:"card",children:"加载中..."}):0===c.length?(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("p",{style:{color:"#666",textAlign:"center"},children:"还没有添加 RSS 源，点击上方按钮添加第一个吧！"})}):c.map(e=>(0,i.jsx)("div",{className:"card",children:(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start",gap:"16px"},children:[(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsx)("h3",{style:{fontSize:"18px",fontWeight:"600",marginBottom:"8px"},children:e.name||e.title}),e.description&&(0,i.jsx)("p",{style:{color:"#666",fontSize:"14px",marginBottom:"8px"},children:e.description}),(0,i.jsx)("p",{style:{fontSize:"12px",color:"#999"},children:e.url}),e.lastFetchAt&&(0,i.jsxs)("p",{style:{fontSize:"12px",color:"#999",marginTop:"8px"},children:["最后抓取: ",a(e.lastFetchAt)]})]}),(0,i.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"flex-end"},children:[(0,i.jsx)("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"12px",fontWeight:"500",background:e.fetchFailureCount<5?"#e8f5e9":"#f5f5f5",color:e.fetchFailureCount<5?"#2e7d32":"#666"},children:e.fetchFailureCount<5?"活跃":"已暂停"}),(0,i.jsx)("button",{onClick:()=>N(e.id),className:"btn btn-secondary",style:{padding:"6px 12px",fontSize:"12px"},disabled:j,children:"立即抓取"})]})]})},e.id))]}),"content"===t&&(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,i.jsx)("h2",{style:{fontSize:"24px",fontWeight:"700"},children:"最新内容"}),h.total>0&&(0,i.jsxs)("p",{style:{color:"#666",fontSize:"14px"},children:["共 ",h.total," 条内容"]})]}),j?(0,i.jsx)("div",{className:"card",children:"加载中..."}):0===p.length?(0,i.jsx)("div",{className:"card",children:(0,i.jsx)("p",{style:{color:"#666",textAlign:"center"},children:"还没有内容，添加 RSS 源后系统会自动抓取内容。"})}):(0,i.jsxs)(i.Fragment,{children:[p.map(e=>(0,i.jsxs)("div",{className:"card",style:{cursor:"pointer",transition:"box-shadow 0.2s"},onClick:()=>y(e),onMouseEnter:e=>e.currentTarget.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)",onMouseLeave:e=>e.currentTarget.style.boxShadow="none",children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[(0,i.jsx)("h3",{style:{fontSize:"18px",fontWeight:"600",flex:1,marginRight:"16px"},children:e.title}),(0,i.jsx)("span",{style:{padding:"4px 8px",background:"#e3f2fd",color:"#1976d2",borderRadius:"4px",fontSize:"12px",whiteSpace:"nowrap"},children:e.sourceName})]}),e.analysis&&(0,i.jsx)("p",{style:{color:"#666",fontSize:"14px",marginBottom:"12px",lineHeight:"1.6"},children:e.analysis.length>200?e.analysis.substring(0,200)+"...":e.analysis}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"12px"},children:[e.topics&&e.topics.length>0&&e.topics.slice(0,3).map((e,t)=>(0,i.jsxs)("span",{style:{padding:"4px 10px",background:"#e8f5e9",color:"#2e7d32",borderRadius:"12px",fontSize:"12px",fontWeight:"500"},children:["\uD83D\uDCDA ",e]},t)),e.keywords&&e.keywords.length>0&&e.keywords.slice(0,3).map((e,t)=>(0,i.jsxs)("span",{style:{padding:"4px 10px",background:"#fff3e0",color:"#e65100",borderRadius:"12px",fontSize:"12px"},children:["\uD83D\uDD11 ",e]},t)),e.sentiment&&(0,i.jsxs)("span",{style:{padding:"4px 10px",background:"#f3e5f5",color:"#7b1fa2",borderRadius:"12px",fontSize:"12px"},children:["\uD83D\uDE0A ",l(e.sentiment)]})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("p",{style:{fontSize:"12px",color:"#999"},children:["发布于: ",a(e.publishedAt)]}),(0,i.jsx)("span",{style:{fontSize:"12px",color:"#0070f3"},children:"点击查看详情 →"})]})]},e.id)),h.totalPages>1&&(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",gap:"12px",marginTop:"32px",padding:"20px 0"},children:[(0,i.jsx)("button",{onClick:()=>m(Math.max(1,g-1)),disabled:1===g,className:"btn btn-secondary",style:{padding:"8px 16px",opacity:1===g?.5:1,cursor:1===g?"not-allowed":"pointer"},children:"← 上一页"}),(0,i.jsx)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:Array.from({length:Math.min(5,h.totalPages)},(e,t)=>{let n;return n=h.totalPages<=5?t+1:g<=3?t+1:g>=h.totalPages-2?h.totalPages-4+t:g-2+t,(0,i.jsx)("button",{onClick:()=>m(n),style:{padding:"8px 12px",border:g===n?"2px solid #0070f3":"1px solid #ddd",borderRadius:"6px",background:g===n?"#0070f3":"white",color:g===n?"white":"#333",cursor:"pointer",fontWeight:g===n?"600":"400",minWidth:"40px"},children:n},n)})}),(0,i.jsx)("button",{onClick:()=>m(Math.min(h.totalPages,g+1)),disabled:g===h.totalPages,className:"btn btn-secondary",style:{padding:"8px 16px",opacity:g===h.totalPages?.5:1,cursor:g===h.totalPages?"not-allowed":"pointer"},children:"下一页 →"})]})]})]}),f&&(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},onClick:()=>y(null),children:(0,i.jsxs)("div",{className:"card",style:{maxWidth:"900px",width:"100%",maxHeight:"90vh",overflow:"auto",position:"relative"},onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("button",{onClick:()=>y(null),style:{position:"absolute",top:"16px",right:"16px",background:"#f5f5f5",border:"none",borderRadius:"50%",width:"32px",height:"32px",cursor:"pointer",fontSize:"20px",lineHeight:"32px",textAlign:"center"},children:"\xd7"}),(0,i.jsx)("div",{style:{marginBottom:"16px"},children:(0,i.jsx)("span",{style:{padding:"4px 12px",background:"#e3f2fd",color:"#1976d2",borderRadius:"4px",fontSize:"12px"},children:f.sourceName})}),(0,i.jsx)("h2",{style:{fontSize:"24px",fontWeight:"700",marginBottom:"16px",paddingRight:"40px"},children:f.title}),(0,i.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap",marginBottom:"20px"},children:[f.topics&&f.topics.map((e,t)=>(0,i.jsxs)("span",{style:{padding:"6px 12px",background:"#e8f5e9",color:"#2e7d32",borderRadius:"16px",fontSize:"13px",fontWeight:"500"},children:["\uD83D\uDCDA ",e]},t)),f.keywords&&f.keywords.map((e,t)=>(0,i.jsxs)("span",{style:{padding:"6px 12px",background:"#fff3e0",color:"#e65100",borderRadius:"16px",fontSize:"13px"},children:["\uD83D\uDD11 ",e]},t))]}),f.sentiment&&(0,i.jsxs)("div",{style:{marginBottom:"20px",padding:"12px",background:"#f3e5f5",borderRadius:"8px"},children:[(0,i.jsx)("strong",{style:{color:"#7b1fa2"},children:"情感倾向："}),(0,i.jsx)("span",{style:{marginLeft:"8px"},children:l(f.sentiment)})]}),f.analysis&&(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#333"},children:"\uD83D\uDCDD AI 分析"}),(0,i.jsx)("p",{style:{color:"#666",lineHeight:"1.8",whiteSpace:"pre-wrap"},children:f.analysis})]}),f.educationalValue&&(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#333"},children:"\uD83C\uDF93 教育价值"}),(0,i.jsx)("p",{style:{color:"#666",lineHeight:"1.8",whiteSpace:"pre-wrap"},children:f.educationalValue})]}),f.content&&(0,i.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,i.jsx)("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#333"},children:"\uD83D\uDCC4 原文内容"}),(0,i.jsx)("div",{style:{color:"#666",lineHeight:"1.8",maxHeight:"400px",overflow:"auto",padding:"16px",background:"#f9f9f9",borderRadius:"8px"},dangerouslySetInnerHTML:{__html:f.content}})]}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingTop:"20px",borderTop:"1px solid #eee"},children:[(0,i.jsxs)("div",{style:{fontSize:"13px",color:"#999"},children:[(0,i.jsxs)("p",{children:["发布时间: ",a(f.publishedAt)]}),f.wordCount&&(0,i.jsxs)("p",{style:{marginTop:"4px"},children:["字数: ",f.wordCount]})]}),f.link&&(0,i.jsx)("a",{href:f.link,target:"_blank",rel:"noopener noreferrer",className:"btn btn-primary",style:{textDecoration:"none"},children:"查看原文 →"})]})]})})]})]})}},1837:function(e,t,n){"use strict";async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=localStorage.getItem("auth_token"),i={"Content-Type":"application/json",...t.headers||{}};n&&(i.Authorization="Bearer ".concat(n));let s=await fetch("".concat("https://moxiang-distill-api.masiqi.workers.dev").concat(e),{...t,headers:i});if(!s.ok)try{let e=await s.json();throw Error(e.error||e.message||"API错误: ".concat(s.statusText))}catch(e){throw Error("API错误: ".concat(s.statusText))}return s.json()}n.d(t,{h:function(){return s}});let s={register:e=>i("/api/v1/auth/register",{method:"POST",body:JSON.stringify(e)}),login:e=>i("/api/v1/auth/login",{method:"POST",body:JSON.stringify(e)}),getSources:()=>i("/api/v1/sources"),getPublicSources:()=>i("/api/v1/sources/public"),getContent:e=>{let t=new URLSearchParams;(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.pageSize)&&t.set("pageSize",e.pageSize.toString());let n=t.toString();return i("/api/v1/content".concat(n?"?".concat(n):""))}}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4774)}),_N_E=e.O()}]);