import { getVal, getAttrPercent } from '../../OpenXML.js';
import { Color } from '../../util/color.js';
import { PresetColorMap } from '../../openxml/colorNameMap.js';
import { modifyColor } from './modifyColor.js';

/**
 * 解析子节点颜色，这里其实还有 lumMod 和 lumOff
 */
function parseChildColor(getThemeColor, element) {
    var colorChild = element.firstElementChild;
    if (colorChild) {
        var colorType = colorChild.tagName;
        switch (colorType) {
            case 'a:prstClr':
                var color = getVal(colorChild) || '';
                if (color in PresetColorMap) {
                    return modifyColor(colorChild, PresetColorMap[color]);
                }
                else {
                    console.warn('parseOutline: Unknown color ', color, colorChild);
                }
                break;
            case 'a:srgbClr':
            case 'a:scrgbClr':
            case 'w14:srgbClr':
                var rgbColor = getVal(colorChild);
                if (rgbColor) {
                    return modifyColor(colorChild, '#' + rgbColor);
                }
                var r = getAttrPercent(colorChild, 'r');
                var g = getAttrPercent(colorChild, 'g');
                var b = getAttrPercent(colorChild, 'b');
                var scrgbColor = Color.fromRGB(r, g, b);
                return modifyColor(colorChild, scrgbColor.toHex());
            case 'a:hslClr':
                var h = getAttrPercent(colorChild, 'r');
                var s = getAttrPercent(colorChild, 'g');
                var l = getAttrPercent(colorChild, 'b');
                var val = getVal(colorChild);
                // 文档例子里有，不确定
                if (val) {
                    return modifyColor(colorChild, '#' + val);
                }
                var hslColor = Color.fromHSL(h, s, l);
                return modifyColor(colorChild, hslColor.toHex());
            case 'a:schemeClr':
            case 'w14:schemeClr':
                var schemeClr = getVal(colorChild);
                if (schemeClr) {
                    return modifyColor(colorChild, getThemeColor(schemeClr));
                }
                else {
                    console.warn('parseOutline: Unknown schemeClr ', colorChild);
                }
                break;
            case 'a:sysClr':
                // 这里每个系统不一样，所以直接依赖浏览器的能力
                return getVal(colorChild);
            default:
                console.warn('parseOutline: Unknown color type ', colorType, colorChild);
        }
    }
    return '';
}

export { parseChildColor };
