import { __awaiter, __generator } from 'tslib';
import { parseWorkbook } from './excel/parseWorkbook.js';
import { parseContentType } from '../../common/parseContentType.js';
import { xml2json } from '../../util/xml.js';
import { CT_Stylesheet_Attributes } from '../../openxml/ExcelTypes.js';
import { autoParse } from '../../common/autoParse.js';

/**
 * 解析 Excel 格式，转成内部数据结构
 */
/**
 * 解析 Excel
 * @param parser
 */
function parseExcel(parser) {
    return __awaiter(this, void 0, void 0, function () {
        var contentTypes, styleSheetNode, styleSheet, workbook;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, parseContentType(parser)];
                case 1:
                    contentTypes = _a.sent();
                    return [4 /*yield*/, xml2json(parser.getString('xl/styles.xml'))];
                case 2:
                    styleSheetNode = _a.sent();
                    styleSheet = autoParse(styleSheetNode, CT_Stylesheet_Attributes);
                    return [4 /*yield*/, parseWorkbook(parser, styleSheet)];
                case 3:
                    workbook = _a.sent();
                    return [2 /*return*/, {
                            contentTypes: contentTypes,
                            workbook: workbook
                        }];
            }
        });
    });
}

export { parseExcel };
