import { H } from '../../../util/H.js';
import { onClickOutside } from '../../../util/onClickOutside.js';
import { Icons } from '../Icons.js';
import { AutoFilterMenuUI } from './AutoFilterMenuUI.js';
import { hasFilterColumn } from './filterColumn/hasFilterColumn.js';
import { getColumnSortOrder } from './sortState/getColumnSortOrder.js';

var AutoFilterIconUI = /** @class */ (function () {
    function AutoFilterIconUI(sheet, dataContainer, autoFilter, rangeRef, colIndex, fid, headerRowCount) {
        if (headerRowCount === void 0) { headerRowCount = 1; }
        var _this = this;
        this.sheet = sheet;
        this.rangeRef = rangeRef;
        this.colIndex = colIndex;
        this.autoFilter = autoFilter;
        var filterIconContainer = H('div', {
            className: 'ov-excel-auto-filter-icon-container',
            parent: dataContainer
        });
        filterIconContainer.dataset.fid = fid;
        this.filterIconContainer = filterIconContainer;
        // 默认隐藏
        filterIconContainer.style.display = 'none';
        var filterIcon = H('div', {
            className: 'ov-excel-auto-filter-icon',
            parent: filterIconContainer
        });
        filterIcon.innerHTML = this.getFilterIcon();
        this.filterIcon = filterIcon;
        this.filterMenu = new AutoFilterMenuUI(this, filterIconContainer, sheet, autoFilter, rangeRef, colIndex, headerRowCount);
        filterIcon.addEventListener('click', this.handleClick.bind(this));
        this.removeClickOutsideEvent = onClickOutside(filterIconContainer, function () {
            _this.hideMenu();
        });
    }
    /**
     * 更新过滤图标
     */
    AutoFilterIconUI.prototype.syncFilterIcon = function () {
        this.filterIcon.innerHTML = this.getFilterIcon();
    };
    AutoFilterIconUI.prototype.getFilterIcon = function () {
        var columnSortState = getColumnSortOrder(this.colIndex, this.rangeRef, this.autoFilter.sortState);
        var filterIconSrc = Icons.filter;
        var filterColumn = hasFilterColumn(this.autoFilter, this.colIndex);
        if (filterColumn) {
            filterIconSrc = Icons.hasFilter;
        }
        if (columnSortState === 'asc') {
            filterIconSrc = Icons.filterUp;
        }
        else if (columnSortState === 'desc') {
            filterIconSrc = Icons.filterDown;
        }
        return filterIconSrc;
    };
    AutoFilterIconUI.prototype.updatePosition = function (x, y, height, width) {
        this.filterIconContainer.style.display = 'block';
        this.filterIconContainer.style.left = "".concat(x, "px");
        this.filterIconContainer.style.top = "".concat(y, "px");
        this.filterIconContainer.style.width = "".concat(width, "px");
        this.filterIconContainer.style.height = "".concat(height, "px");
        this.filterIcon.style.width = "".concat(height - 4, "px");
    };
    AutoFilterIconUI.prototype.handleClick = function () {
        var lastAutoFilter = this.sheet.getLastAutoFilterIcon();
        if (lastAutoFilter) {
            lastAutoFilter.hideMenu();
        }
        this.sheet.setLastAutoFilterIcon(this);
        this.showMenu();
    };
    AutoFilterIconUI.prototype.showMenu = function () {
        this.filterMenu.show();
    };
    AutoFilterIconUI.prototype.hideMenu = function () {
        this.filterMenu.hide();
    };
    AutoFilterIconUI.prototype.hide = function () {
        this.filterIconContainer.style.display = 'none';
    };
    AutoFilterIconUI.prototype.destroy = function () {
        this.filterIconContainer.remove();
        this.removeClickOutsideEvent();
    };
    return AutoFilterIconUI;
}());

export { AutoFilterIconUI };
