import { MAX_ROW, MAX_COL } from '../Consts.js';
import { getCellColPosition, getCellRowPosition } from './getCellPosition.js';

/**
 * 算出选中区域的位置信息
 */
function getRangePosition(workbook, region, cellRange) {
    var activeSheet = workbook.getActiveSheet();
    // 获取开始位置，如果找不到就当成 0
    var startX = 0;
    var startColPosition = getCellColPosition(activeSheet, region, cellRange.startCol);
    if (startColPosition) {
        startX = startColPosition.x;
    }
    var startY = 0;
    var startRowPosition = getCellRowPosition(activeSheet, region, cellRange.startRow);
    if (startRowPosition) {
        startY = startRowPosition.y;
    }
    // TODO: 目前还有一种情况没测过，就是当选取大于显示范围的时候
    var _a = workbook.getViewpointSize(), width = _a.width, height = _a.height;
    // 如果找不到就当成最大值
    var endX = 0;
    var endY = 0;
    var endWidth = 0;
    var endHeight = 0;
    var endRowPosition = getCellRowPosition(activeSheet, region, cellRange.endRow);
    if (endRowPosition) {
        endY = endRowPosition.y;
        endHeight = endRowPosition.height;
    }
    if (cellRange.endRow === MAX_ROW) {
        endY = height;
        // 随便有个值就行
        endHeight = 1;
    }
    var endColPosition = getCellColPosition(activeSheet, region, cellRange.endCol);
    if (endColPosition) {
        endX = endColPosition.x;
        endWidth = endColPosition.width;
    }
    if (cellRange.endCol === MAX_COL) {
        endX = width;
        // 随便有个值就行
        endWidth = 1;
    }
    // 全都找不到意味着在显示范围外了
    if (!startColPosition &&
        !startRowPosition &&
        !endRowPosition &&
        !endColPosition) {
        return {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        };
    }
    return {
        x: startX,
        y: startY,
        width: endX + endWidth - startX,
        height: endY + endHeight - startY
    };
}

export { getRangePosition };
