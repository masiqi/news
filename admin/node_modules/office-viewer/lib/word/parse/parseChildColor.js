'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var OpenXML = require('../../OpenXML.js');
var color = require('../../util/color.js');
var colorNameMap = require('../../openxml/colorNameMap.js');
var modifyColor = require('./modifyColor.js');

/**
 * 解析子节点颜色，这里其实还有 lumMod 和 lumOff
 */
function parseChildColor(getThemeColor, element) {
    var colorChild = element.firstElementChild;
    if (colorChild) {
        var colorType = colorChild.tagName;
        switch (colorType) {
            case 'a:prstClr':
                var color$1 = OpenXML.getVal(colorChild) || '';
                if (color$1 in colorNameMap.PresetColorMap) {
                    return modifyColor.modifyColor(colorChild, colorNameMap.PresetColorMap[color$1]);
                }
                else {
                    console.warn('parseOutline: Unknown color ', color$1, colorChild);
                }
                break;
            case 'a:srgbClr':
            case 'a:scrgbClr':
            case 'w14:srgbClr':
                var rgbColor = OpenXML.getVal(colorChild);
                if (rgbColor) {
                    return modifyColor.modifyColor(colorChild, '#' + rgbColor);
                }
                var r = OpenXML.getAttrPercent(colorChild, 'r');
                var g = OpenXML.getAttrPercent(colorChild, 'g');
                var b = OpenXML.getAttrPercent(colorChild, 'b');
                var scrgbColor = color.Color.fromRGB(r, g, b);
                return modifyColor.modifyColor(colorChild, scrgbColor.toHex());
            case 'a:hslClr':
                var h = OpenXML.getAttrPercent(colorChild, 'r');
                var s = OpenXML.getAttrPercent(colorChild, 'g');
                var l = OpenXML.getAttrPercent(colorChild, 'b');
                var val = OpenXML.getVal(colorChild);
                // 文档例子里有，不确定
                if (val) {
                    return modifyColor.modifyColor(colorChild, '#' + val);
                }
                var hslColor = color.Color.fromHSL(h, s, l);
                return modifyColor.modifyColor(colorChild, hslColor.toHex());
            case 'a:schemeClr':
            case 'w14:schemeClr':
                var schemeClr = OpenXML.getVal(colorChild);
                if (schemeClr) {
                    return modifyColor.modifyColor(colorChild, getThemeColor(schemeClr));
                }
                else {
                    console.warn('parseOutline: Unknown schemeClr ', colorChild);
                }
                break;
            case 'a:sysClr':
                // 这里每个系统不一样，所以直接依赖浏览器的能力
                return OpenXML.getVal(colorChild);
            default:
                console.warn('parseOutline: Unknown color type ', colorType, colorChild);
        }
    }
    return '';
}

exports.parseChildColor = parseChildColor;
