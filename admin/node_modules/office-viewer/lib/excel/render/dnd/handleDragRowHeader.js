'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var Consts = require('../Consts.js');
var handleMousedown = require('./handleMousedown.js');

/**
 * 处理拖拽行表头扩展选区
 */
function handleDragRowHeader(offsetX, offsetY) {
    var _a, _b, _c;
    // 没有 selection 的情况不大可能，但避免出错
    if (!handleMousedown.dragState.selection) {
        console.warn('没有 selection');
        return;
    }
    // 做 hitTest，判断是否拖到了其它行表头
    var hitTestResult = (_a = handleMousedown.dragState.workbook) === null || _a === void 0 ? void 0 : _a.getActiveSheet().hitTest(offsetX, offsetY);
    var row = handleMousedown.dragState.selection.activeCell.startRow;
    // 后续要支持多选得改这里
    var firstCellRange = handleMousedown.dragState.selection.cellRanges[0];
    if (hitTestResult) {
        // 还不支持跨区域拖拽
        if (hitTestResult.region !== handleMousedown.dragState.region) {
            console.warn('不支持跨区域拖拽');
            return;
        }
        // 说明移动到别的行了
        if (hitTestResult.startRow !== row) {
            var startRow = Math.min(row, hitTestResult.startRow);
            var endRow = Math.max(row, hitTestResult.startRow);
            if (startRow === firstCellRange.startRow &&
                endRow === firstCellRange.endRow) {
                return;
            }
            firstCellRange.startRow = startRow;
            firstCellRange.endRow = endRow;
            firstCellRange.startCol = 0;
            firstCellRange.endCol = Consts.MAX_COL;
            (_b = handleMousedown.dragState.workbook) === null || _b === void 0 ? void 0 : _b.uiEvent.emit('CHANGE_SELECTION', handleMousedown.dragState.selection);
        }
        else {
            // 如果在当前行移动，需要判断和现有选区是否有变化
            if (firstCellRange.startRow !== firstCellRange.endRow) {
                firstCellRange.endRow = firstCellRange.startRow;
                firstCellRange.startCol = 0;
                firstCellRange.endCol = Consts.MAX_COL;
                (_c = handleMousedown.dragState.workbook) === null || _c === void 0 ? void 0 : _c.uiEvent.emit('CHANGE_SELECTION', handleMousedown.dragState.selection);
            }
        }
    }
}

exports.handleDragRowHeader = handleDragRowHeader;
