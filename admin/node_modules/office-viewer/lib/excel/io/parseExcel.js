'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var tslib = require('tslib');
var parseWorkbook = require('./excel/parseWorkbook.js');
var parseContentType = require('../../common/parseContentType.js');
var xml = require('../../util/xml.js');
var ExcelTypes = require('../../openxml/ExcelTypes.js');
var autoParse = require('../../common/autoParse.js');

/**
 * 解析 Excel 格式，转成内部数据结构
 */
/**
 * 解析 Excel
 * @param parser
 */
function parseExcel(parser) {
    return tslib.__awaiter(this, void 0, void 0, function () {
        var contentTypes, styleSheetNode, styleSheet, workbook;
        return tslib.__generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, parseContentType.parseContentType(parser)];
                case 1:
                    contentTypes = _a.sent();
                    return [4 /*yield*/, xml.xml2json(parser.getString('xl/styles.xml'))];
                case 2:
                    styleSheetNode = _a.sent();
                    styleSheet = autoParse.autoParse(styleSheetNode, ExcelTypes.CT_Stylesheet_Attributes);
                    return [4 /*yield*/, parseWorkbook.parseWorkbook(parser, styleSheet)];
                case 3:
                    workbook = _a.sent();
                    return [2 /*return*/, {
                            contentTypes: contentTypes,
                            workbook: workbook
                        }];
            }
        });
    });
}

exports.parseExcel = parseExcel;
