# Story 1.5: RSS源管理与共享功能

## Status
Ready for Implementation

## Story
**As a** 平台用户,
**I want** 能够使用系统提供的公共RSS源并可以复制为自己的私有源,
**so that** 我可以灵活配置我的新闻源，同时不受他人修改影响

## Acceptance Criteria
- [ ] 系统可以提供预设的公共RSS源（由系统用户ID=1提供）
- [ ] RSS源可以标记为公开或私有
- [ ] 其他用户可以查看公开的RSS源
- [ ] 用户可以复制公开的RSS源到自己的账户下
- [ ] 复制的RSS源独立于原始源，不受其变更影响
- [ ] 私有RSS源对其他用户不可见

## Tasks / Subtasks
- [x] Task 1: 扩展RSS源数据模型 (AC: 1, 2, 4)
  - [x] 添加isPublic字段标识源的公开/私有状态
  - [x] 添加originalSourceId字段支持复制功能
- [in_progress] Task 2: 实现RSS源CRUD API (AC: 1, 2, 5, 6)
  - [x] 创建系统用户（ID=1）用于提供公共源
  - [x] 实现创建、读取、更新、删除RSS源的API端点
  - [x] 实现公开/私有源的访问控制
- [in_progress] Task 3: 实现RSS源复制功能 (AC: 4, 5)
  - [x] 创建复制公开RSS源到用户账户的API端点
  - [x] 确保复制的源独立于原始源
- [ ] Task 4: 实现前端RSS源管理界面 (AC: 1, 2, 3, 4, 5, 6)
  - [ ] 创建公共RSS源浏览页面
  - [ ] 创建用户私有RSS源管理页面
  - [ ] 实现复制功能的UI

## Dev Notes

### 数据模型信息
- **`sources`**: 扩展现有RSS源表，添加isPublic和originalSourceId字段
- **`system user`**: ID为1的特殊用户，用于提供系统公共RSS源

### API规范信息
- 需要扩展POST /sources端点支持公开/私有标记
- 需要创建POST /sources/{id}/copy端点实现复制功能
- 需要创建GET /sources/public端点获取公共RSS源列表

### 技术栈信息
- **前端框架**: Next.js ~15.0 [Source: architecture.md#3]
- **后端框架**: Hono.js ~4.4 [Source: architecture.md#3]
- **数据库**: Cloudflare D1 [Source: architecture.md#3]
- **ORM**: Drizzle ORM ~0.30 [Source: architecture.md#3]

### 文件路径和命名约定
- 数据库schema：backend/src/db/schema.ts
- 数据库迁移：backend/src/db/migrations/
- 数据库类型定义：backend/src/db/types.ts
- 后端服务层：backend/src/services/source.service.ts
- 后端API路由：backend/src/routes/sources.ts
- 前端页面组件：frontend/src/app/sources/
- 前端API路由：frontend/src/app/api/sources/

### 测试要求
- 需要验证公开/私有源的访问控制
- 需要验证RSS源复制功能的正确性
- 需要验证复制源的独立性

### 技术约束
- 必须确保数据隔离，用户只能访问自己的私有源和公共源
- 复制的源必须完全独立于原始源

### 安全性要求
- 必须正确实现访问控制，防止未授权访问
- 必须确保用户数据的多租户隔离 [Source: prd.md#NFR1]

## Testing

### 测试标准
- 公共/私有源访问控制正确性
- RSS源复制功能正确性
- 复制源独立性验证
- 数据隔离验证

### 测试框架和模式
- 使用Vitest进行单元测试 [Source: architecture.md#3]
- 使用Playwright进行端到端测试 [Source: architecture.md#3]
- 需要测试各种边界情况和异常情况
- 需要测试安全性相关场景

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-09-03 | 1.0 | Initial draft | Bob (Scrum Master) |

## Dev Agent Record
记录了Story 1.5的初步实现过程，包括数据库schema扩展、服务层创建等。

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- 数据库schema扩展完成
- RSS源服务层创建完成
- 迁移文件创建完成

### Completion Notes List
1. 成功扩展了RSS源数据模型，添加了isPublic和originalSourceId字段
2. 创建了SourceService服务层，提供了完整的RSS源管理功能
3. 创建了数据库迁移文件，用于更新生产环境数据库
4. 创建了数据库类型定义文件，提供TypeScript类型支持
5. 实现了后端API路由，支持RSS源的CRUD操作和复制功能

### File List
- backend/src/db/schema.ts
- backend/src/db/migrations/0002_add_source_visibility_and_copy_fields.sql
- backend/src/db/types.ts
- backend/src/services/source.service.ts
- backend/src/routes/sources.ts
- backend/src/scripts/init-system-user.ts

## QA Results
正在进行中，已完成数据库schema扩展和服务层创建。