# **墨香蒸馏 产品需求文档 (PRD)**





## **1. 目标和背景 (Goals and Background Context)**





### **目标 (Goals)**



- **[G1]** 为知识工作者提供一个全自动的、“一次性极简配置”的资讯处理与知识沉淀SaaS平台。
- **[G2]** 实现用户通过简约的Web界面，轻松管理个人化的RSS资讯源。
- **[G3]** 通过系统内置的、基于Cloudflare Workers AI的LLM服务，实现对资讯的深度加工（MVP阶段核心为“当日简报”）。
- **[G4]** 确保多租户架构下，每位用户的配置和数据都通过技术手段实现严格的安全隔离。
- **[G5]** 打造一个可靠的、基于Cloudflare Queues的异步处理架构，以保证长时间AI任务的稳定执行。
- **[G6]** 将处理后的Markdown笔记自动交付到由系统管理的Cloudflare R2存储中，并通过专用只读凭证，方便用户与Obsidian等工具集成。
- **[G7]** 在MVP阶段，通过设定公平的用量上限，验证核心模式的可行性，并为未来的可持续运营（如付费方案）进行架构和数据上的准备。



### **背景 (Background Context)**



在当前信息爆炸的环境下，知识工作者面临着持续的信息过载挑战。他们花费大量时间手动追踪、筛选、总结并整合新资讯到个人知识库，这一过程效率低下且难以形成系统性洞察。本项目旨在解决这一痛点，通过构建一个基于Cloudflare无服务器架构的AI资讯服务平台，将繁琐的手动流程自动化，让用户能更专注于知识的吸收和创造，而非信息整理。



### **核心原则与设计约束 (Core Principles & Design Constraints)**



1. **关于可靠性 (Reliability Principle)**: 所有异步任务必须包含明确的失败处理和重试逻辑（3次指数退避）。必须配置死信队列（Dead-Letter Queue）来捕获并记录处理失败的最终消息，并建立相应的监控报警机制。
2. **关于安全性 (Security-First Principle)**: 安全为最高优先级。MVP阶段必须完整实现动态生成范围限定的只读R2凭证的功能。此功能应被视为核心基础设施，并优先排期。
3. **关于用户体验 (Seamless Experience Principle)**: Web界面必须为“一次性配置”提供极致的引导。对于异步任务，必须提供清晰的状态反馈机制，让用户了解其任务的进展。
4. **关于可测试性 (Testability Principle)**: 所有功能都必须是可测试的。对于异步流程和LLM，需要构建相应的测试框架和策略。
5. **关于成本与性能的约束 (Cost & Performance Constraint)**: LLM选型需兼顾成本与性能。团队应在项目初期对Cloudflare Workers AI中的1-2个候选模型进行基准测试。



### **变更日志 (Change Log)**



| 日期       | 版本 | 描述         | 作者      |
| ---------- | ---- | ------------ | --------- |
| 2025-09-02 | 1.0  | 初始草稿创建 | John (pm) |

导出到 Google 表格



## **2. 需求 (Requirements)**





### **功能性需求 (Functional Requirements)**



- **[FR1]** **用户账户管理**: 系统必须支持用户通过Web界面进行注册、登录和登出。
- **[FR2]** **RSS源管理**: 登录后的用户必须能够通过Web界面对自己订阅的RSS源进行添加、查看、编辑和删除操作。
- **[FR3]** **自动内容抓取**: 系统必须能够基于用户配置的RSS源列表，每日定时、自动地抓取最新的文章内容。
- **[FR4]** **LLM内容处理**: 系统必须能够将抓取到的文章内容，通过内置的LLM服务（Cloudflare Workers AI）进行处理，生成“当日简报”或摘要。
- **[FR5]** **Markdown文件生成**: 系统必须能够将LLM的处理结果格式化为结构清晰的Markdown (.md) 文件。
- **[FR6]** **自动存储配置**: 当一个新用户注册时，系统必须在后台自动为其在Cloudflare R2中创建一个唯一的、隔离的、无法被其他用户猜测到的存储目录。
- **[FR7]** **文件自动交付**: 系统必须能够将生成的Markdown文件，自动上传到对应用户的专属R2目录中。
- **[FR8]** **同步凭证管理**: 登录后的用户必须能够通过Web界面，为自己的R2目录生成/重置一对专用的、只读的、有时效性的API访问凭证。
- **[FR9]** 系统需提供一个按分类组织的、由平台预设和管理的推荐RSS源列表。
- **[FR10]** 系统需在用户首次登录时，引导其完成兴趣选择，并根据选择推荐相应的RSS源。



### **非功能性需求 (Non-Functional Requirements)**



- **[NFR1]** **安全性**: 系统必须在架构层面确保完全的多租户数据隔离。任何用户的API凭证或操作，都绝不能访问到其他用户的数据或配置。
- **[NFR2]** **可靠性**: 系统的异步处理流程（基于Cloudflare Queues）必须包含失败重试和死信队列机制。
- **[NFR3]** **可用性**: Web配置界面必须设计得足够简洁直观，并提供清晰的异步任务状态反馈。
- **[NFR4]** **可扩展性**: 系统架构必须支持未来的平滑扩展，以支持更高级的LLM功能和潜在的付费订阅方案。
- **[NFR5]** **成本控制**: 每位用户的免费额度上限设定为每日处理100篇文章。
- **[NFR6]** **可维护性**: LLM模型的选择应在代码中解耦，以便未来可以轻松切换或增加新的模型。



## **3. 用户界面设计目标 (User Interface Design Goals)**





### **3.1 整体UX愿景 (Overall UX Vision)**



创造一个“安静而强大”的、定位为“个人知识助理”的后台工具。用户体验的核心是“一次性极简配置”，界面应高度直观、简洁，让用户能在2分钟内完成从注册到启动自动化的所有设置。



### **3.2 关键交互范式 (Key Interaction Paradigms)**



- **单页应用 (SPA)**: 提供流畅的桌面应用感。
- **即时反馈**: 用户的每一个操作都应有即时的、清晰的视觉反馈。
- **异步状态透明化**: 必须有专门的区域清晰地展示后台异步任务的状态。



### **3.3 核心页面 (Core Screens)**



- **注册/登录页**
- **仪表盘/主页**
- **RSS源管理页**
- **设置页**



### **3.4 无障碍标准 (Accessibility)**



- **标准**: 默认遵循 **WCAG 2.1 AA** 标准。



### **3.5 品牌风格 (Branding)**



- **风格**: 简洁、现代、友好、智能、值得信赖。



### **3.6 目标平台 (Target Platforms)**



- **平台**: **响应式Web应用**。



## **4. 技术假设 (Technical Assumptions)**





### **4.1 代码仓库结构 (Repository Structure)**



- **假设**: 采用 **Monorepo** 结构。
- **待定决策**: 具体的Monorepo管理工具由**架构/开发团队**进行选型。



### **4.2 服务架构 (Service Architecture)**



- **假设**: 采用 **无服务器架构 (Serverless)**。
- **约束**: 本地开发流程**必须**围绕Cloudflare Wrangler CLI建立。



### **4.3 测试要求 (Testing Requirements)**



- **假设**: MVP阶段的测试策略为 **单元测试 + 集成测试 (Unit + Integration Tests)**。
- **待定决策**: 具体的测试库由**架构/开发团队**进行选型。



### **4.4 其他技术假设与请求 (Additional Technical Assumptions and Requests)**



- **核心平台**: **Cloudflare** (Workers, Pages, Queues, D1, R2, Workers AI)。
- **开发语言**: **TypeScript**。
- **数据库**: **Cloudflare D1**，并采用 **Drizzle ORM** 进行Schema管理和迁移。
- **前端框架**: 采用现代前端框架，具体选型由**UX/设计师**决定。



## **5. 史诗列表 (Epic List)**





### **MVP 阶段 (核心交付)**



- **史诗 1: 平台基础与用户核心系统**: 建立项目的核心技术基础、用户认证体系和基础Web界面。
- **史诗 2: 核心数据管道与手动配置**: 实现从RSS源配置、内容抓取、LLM分析到Markdown文件交付至R2的完整端到端数据处理流程。
- **史诗 3: 新手引导与体验优化**: 通过引入兴趣选择、推荐源列表和更完善的状态通知，极大地简化新用户的入门流程。



### **MVP 后续阶段 (Post-MVP)**



- **史诗 4: 后台管理系统 (Admin System)**: 开发一个基于Amis的内部管理Web界面，供平台管理员进行用户管理和系统维护。



## **6. 史诗详情 (Epic Details)**





### **史诗 1: 平台基础与用户核心系统**



- **故事 1.1: 项目脚手架与持续部署**: 作为开发者，我想要一个包含前后端的Monorepo项目，以便配置好CI/CD流水线。
- **故事 1.2: 用户注册与环境配置**: 作为新访客，我想要使用邮箱和密码注册账户，以便开始使用服务。
- **故事 1.3: 用户登录与会话管理**: 作为已注册用户，我想要登录，以便访问我的个人仪表盘。
- **故事 1.4: 基础仪表盘与登出功能**: 作为一个已登录用户，我想要看到一个个人仪表盘并能安全地登出。



### **史诗 2: 核心数据管道与手动配置**



- **故事 2.1: RSS 源管理界面与API**: 作为一个已登录用户，我想要一个Web界面来增删改查我的RSS源。
- **故事 2.2: 异步处理管道搭建**: 作为一个开发者，我想要搭建起“生产者-队列-消费者”的完整异步处理管道。
- **故事 2.3: LLM 集成与 Markdown 生成**: 作为一个用户，我希望系统能利用AI模型分析文章并生成Markdown笔记。
- **故事 2.4: 安全同步凭证生成界面**: 作为一个用户，我想要在网站上安全地获取凭证来配置我的同步插件。



### **史诗 3: 新手引导与体验优化**



- **故事 3.1: 社区推荐源后台管理**: 作为一个平台管理员，我想要一个基础的管理机制来维护推荐的RSS源列表。
- **故事 3.2: 新用户兴趣引导流程**: 作为一个新用户，我想要在注册后被引导选择兴趣，以便系统为我推荐资讯源。
- **故事 3.3: 仪表盘状态通知系统**: 作为一个用户，我想要在仪表盘上看到我的资讯处理任务的最新状态。



## **7. 清单检查结果 (Checklist Results Report)**



- **状态**: **通过 (PASS)**
- **摘要**: 本PRD是经过详细、协作式问答完成的，所有关键检查项均已满足。



## **8. 后续步骤 (Next Steps)**



- **架构师提示**: 请基于本PRD设计一个完整的全栈无服务器架构。关键约束包括：Cloudflare生态、Monorepo、Drizzle ORM，以及必须支持安全的多租户功能。