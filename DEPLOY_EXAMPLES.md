# éƒ¨ç½²è„šæœ¬ä½¿ç”¨ç¤ºä¾‹

## ğŸ“ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ 1: é¦–æ¬¡å®Œæ•´éƒ¨ç½²

é¦–æ¬¡éƒ¨ç½²æ•´ä¸ªé¡¹ç›®ï¼š

```bash
# æ–¹å¼ 1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy-all.sh
# é€‰æ‹©é€‰é¡¹ 1 (å…¨éƒ¨éƒ¨ç½²)

# æ–¹å¼ 2: ä½¿ç”¨ npm è„šæœ¬
npm run deploy
# ç„¶åé€‰æ‹©é€‰é¡¹ 1
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. âœ… æ£€æŸ¥ç¯å¢ƒå’Œ Cloudflare ç™»å½•çŠ¶æ€
2. ğŸ“¦ éƒ¨ç½²åç«¯ Worker
3. âš™ï¸ éƒ¨ç½²ç®¡ç†åå°åˆ° Pages
4. ğŸŒ éƒ¨ç½²å‰ç«¯ç½‘ç«™åˆ° Pages
5. ğŸ‰ æ˜¾ç¤ºæ‰€æœ‰è®¿é—®åœ°å€

---

### åœºæ™¯ 2: ä»…æ›´æ–°åç«¯ä»£ç 

ä¿®æ”¹äº†åç«¯ä»£ç ï¼Œåªéœ€è¦é‡æ–°éƒ¨ç½²åç«¯ï¼š

```bash
# æ–¹å¼ 1: ç›´æ¥è¿è¡Œåç«¯éƒ¨ç½²è„šæœ¬
cd backend
./deploy.sh

# æ–¹å¼ 2: ä½¿ç”¨ npm è„šæœ¬
npm run deploy:backend
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ğŸ“¦ å®‰è£…åç«¯ä¾èµ–
2. ğŸ”¨ æ„å»ºåç«¯é¡¹ç›®
3. ğŸ—„ï¸ è¯¢é—®æ˜¯å¦æ‰§è¡Œæ•°æ®åº“è¿ç§»
4. â˜ï¸ éƒ¨ç½² Worker
5. ğŸ¥ å¥åº·æ£€æŸ¥éªŒè¯

---

### åœºæ™¯ 3: æ›´æ–°å‰ç«¯æ ·å¼

ä»…ä¿®æ”¹äº†å‰ç«¯æ ·å¼æˆ–é¡µé¢ï¼š

```bash
# æ–¹å¼ 1: ç›´æ¥è¿è¡Œå‰ç«¯éƒ¨ç½²è„šæœ¬
cd frontend
./deploy.sh

# æ–¹å¼ 2: ä½¿ç”¨ npm è„šæœ¬
npm run deploy:frontend
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–
2. ğŸ”¨ æ„å»ºé™æ€ç½‘ç«™
3. â˜ï¸ éƒ¨ç½²åˆ° Pages
4. âœ… æ˜¾ç¤ºè®¿é—®åœ°å€

---

### åœºæ™¯ 4: æ›´æ–°ç®¡ç†åå°é…ç½®

ä¿®æ”¹äº†ç®¡ç†åå°çš„ API åœ°å€æˆ–å…¶ä»–é…ç½®ï¼š

```bash
# æ–¹å¼ 1: ç›´æ¥è¿è¡Œç®¡ç†åå°éƒ¨ç½²è„šæœ¬
cd admin
./deploy.sh

# æ–¹å¼ 2: ä½¿ç”¨ npm è„šæœ¬
npm run deploy:admin
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. ğŸ“‹ æ˜¾ç¤ºå½“å‰é…ç½®
2. ğŸ”§ è¯¢é—®æ˜¯å¦æ›´æ–° API URL
3. â˜ï¸ éƒ¨ç½²åˆ° Pages
4. âœ… æ˜¾ç¤ºè®¿é—®åœ°å€

---

### åœºæ™¯ 5: éƒ¨ç½²åç«¯å’Œç®¡ç†åå°

åç«¯ API æœ‰æ›´æ–°ï¼Œéœ€è¦åŒæ—¶æ›´æ–°ç®¡ç†åå°ï¼š

```bash
./deploy-all.sh
# é€‰æ‹©é€‰é¡¹ 5 (åç«¯ + ç®¡ç†åå°)
```

---

### åœºæ™¯ 6: éƒ¨ç½²ç®¡ç†åå°å’Œå‰ç«¯

æ›´æ–°äº†å‰ç«¯é¡µé¢å’Œç®¡ç†åå°é…ç½®ï¼š

```bash
./deploy-all.sh
# é€‰æ‹©é€‰é¡¹ 6 (ç®¡ç†åå° + å‰ç«¯)
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æäº¤ä¿¡æ¯

å‰ç«¯å’Œç®¡ç†åå°çš„éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„æäº¤ä¿¡æ¯ï¼Œå¦‚éœ€è‡ªå®šä¹‰ï¼š

```bash
# ä¿®æ”¹éƒ¨ç½²è„šæœ¬ä¸­çš„ COMMIT_MESSAGE å˜é‡
cd frontend
# ç¼–è¾‘ deploy.sh
COMMIT_MESSAGE="ä¿®å¤ç™»å½•é¡µé¢æ ·å¼é—®é¢˜"
./deploy.sh
```

### è·³è¿‡æ•°æ®åº“è¿ç§»

åç«¯éƒ¨ç½²æ—¶å¦‚æœä¸éœ€è¦æ‰§è¡Œè¿ç§»ï¼š

```bash
cd backend
./deploy.sh
# å½“è¯¢é—®æ˜¯å¦æ‰§è¡Œæ•°æ®åº“è¿ç§»æ—¶ï¼Œè¾“å…¥ n æˆ–ç›´æ¥å›è½¦
```

### æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

```bash
# æŸ¥çœ‹ Worker å®æ—¶æ—¥å¿—
npx wrangler tail moxiang-distill

# æŸ¥çœ‹ Pages éƒ¨ç½²å†å²
npx wrangler pages deployment list --project-name=moxiang-distill-frontend
```

---

## ğŸ› å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜ 1: æœªç™»å½• Cloudflare

**é”™è¯¯ä¿¡æ¯ï¼š**
```
âŒ æœªç™»å½• Cloudflareï¼Œè¯·å…ˆè¿è¡Œ: npx wrangler login
```

**è§£å†³æ–¹æ³•ï¼š**
```bash
npx wrangler login
# æµè§ˆå™¨ä¼šæ‰“å¼€ï¼Œå®Œæˆç™»å½•æˆæƒ
```

---

### é—®é¢˜ 2: æƒé™ä¸è¶³

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Permission denied: ./deploy.sh
```

**è§£å†³æ–¹æ³•ï¼š**
```bash
chmod +x deploy-all.sh
chmod +x backend/deploy.sh
chmod +x admin/deploy.sh
chmod +x frontend/deploy.sh
```

---

### é—®é¢˜ 3: æ„å»ºå¤±è´¥

**åç«¯æ„å»ºå¤±è´¥ï¼š**
```bash
cd backend
npm install
npm run build
# æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
```

**å‰ç«¯æ„å»ºå¤±è´¥ï¼š**
```bash
cd frontend
npm install
npm run build
# æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
```

---

### é—®é¢˜ 4: Pages é¡¹ç›®ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Project not found
```

**è§£å†³æ–¹æ³•ï¼š**
éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºé¡¹ç›®ï¼Œå¦‚æœä»ç„¶å¤±è´¥ï¼Œæ‰‹åŠ¨åˆ›å»ºï¼š

```bash
# å‰ç«¯
npx wrangler pages project create moxiang-distill-frontend --production-branch=main

# ç®¡ç†åå°
npx wrangler pages project create moxiang-distill-admin --production-branch=main
```

---

## ğŸ“Š éƒ¨ç½²æ—¶é—´å‚è€ƒ

| æœåŠ¡ | ä¾èµ–å®‰è£… | æ„å»ºæ—¶é—´ | éƒ¨ç½²æ—¶é—´ | æ€»è®¡ |
|------|---------|---------|---------|------|
| åç«¯ | ~30s | ~10s | ~20s | ~60s |
| ç®¡ç†åå° | N/A | N/A | ~15s | ~15s |
| å‰ç«¯ | ~25s | ~30s | ~20s | ~75s |
| **å…¨éƒ¨** | ~55s | ~40s | ~55s | **~150s** |

*æ—¶é—´ä»…ä¾›å‚è€ƒï¼Œå®é™…æ—¶é—´å–å†³äºç½‘ç»œé€Ÿåº¦å’Œé¡¹ç›®å¤§å°*

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **å¼€å‘æµç¨‹ï¼š**
   ```bash
   # æœ¬åœ°å¼€å‘
   npm run dev

   # æµ‹è¯•æ„å»º
   npm run build

   # éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
   npm run deploy
   ```

2. **ç‰ˆæœ¬æ§åˆ¶ï¼š**
   ```bash
   # æäº¤ä»£ç å‰å…ˆç¡®ä¿æœ¬åœ°æ„å»ºæˆåŠŸ
   git add .
   git commit -m "feat: æ–°å¢åŠŸèƒ½"

   # éƒ¨ç½²åˆ° Cloudflare
   npm run deploy

   # æ¨é€åˆ°è¿œç¨‹ä»“åº“
   git push
   ```

3. **å›æ»šç­–ç•¥ï¼š**
   ```bash
   # æŸ¥çœ‹å†å²éƒ¨ç½²
   npx wrangler pages deployment list --project-name=moxiang-distill-frontend

   # å¦‚éœ€å›æ»šï¼Œé‡æ–°éƒ¨ç½²ä¹‹å‰çš„ä»£ç ç‰ˆæœ¬
   git checkout <previous-commit>
   npm run deploy
   git checkout main
   ```

---

## ğŸ’¡ å°è´´å£«

- ğŸ”„ **è‡ªåŠ¨åŒ–éƒ¨ç½²**: å¯ä»¥é…ç½® GitHub Actions è‡ªåŠ¨éƒ¨ç½²
- ğŸ“Š **ç›‘æ§å‘Šè­¦**: åœ¨ Cloudflare Dashboard è®¾ç½®é”™è¯¯å‘Šè­¦
- ğŸ” **ç¯å¢ƒå˜é‡**: æ•æ„Ÿä¿¡æ¯ä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
- ğŸŒ **è‡ªå®šä¹‰åŸŸå**: Pages æ”¯æŒç»‘å®šè‡ªå®šä¹‰åŸŸå
- ğŸ“ **æ—¥å¿—æ”¶é›†**: ä½¿ç”¨ `wrangler tail` å®æ—¶æŸ¥çœ‹æ—¥å¿—

---

## ğŸ”— ç›¸å…³å‘½ä»¤é€ŸæŸ¥

```bash
# æŸ¥çœ‹å½“å‰ç™»å½•çŠ¶æ€
npx wrangler whoami

# æŸ¥çœ‹ Worker åˆ—è¡¨
npx wrangler deployments list

# æŸ¥çœ‹ Pages é¡¹ç›®åˆ—è¡¨
npx wrangler pages project list

# æŸ¥çœ‹ D1 æ•°æ®åº“åˆ—è¡¨
npx wrangler d1 list

# æŸ¥çœ‹ R2 å­˜å‚¨æ¡¶åˆ—è¡¨
npx wrangler r2 bucket list

# æŸ¥çœ‹é˜Ÿåˆ—åˆ—è¡¨
npx wrangler queues list
```

---

æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ [DEPLOYMENT.md](./DEPLOYMENT.md)
